const{body:body,validationResult:validationResult}=require("express-validator"),{MOTIVOS_ADMINISTRATIVOS:MOTIVOS_ADMINISTRATIVOS}=require("../constantes"),todosLosMotivos=[].concat(MOTIVOS_ADMINISTRATIVOS.Perfeccionamiento,MOTIVOS_ADMINISTRATIVOS.Reglamento,MOTIVOS_ADMINISTRATIVOS.Particulares),manejarValidacion=(req,res,next)=>{const errors=validationResult(req);if(!errors.isEmpty())return res.status(400).json({error:errors.array()[0].msg});next()},reglasCreacionSolicitud=[body("tipo").isIn(["TELETRABAJO","ADMINISTRATIVO"]).withMessage("El tipo de solicitud es inválido."),body("fechaInicio").notEmpty().withMessage("La fecha de inicio es requerida.").isISO8601().toDate().withMessage("Formato de fecha de inicio inválido."),body("fechaFin").notEmpty().withMessage("La fecha de fin es requerida.").isISO8601().toDate().withMessage("Formato de fecha de fin inválido."),body("jornada").isIn(["COMPLETO","MANANA","TARDE"]).withMessage("El tipo de jornada es inválido."),body().custom((value,{req:req})=>{const{tipo:tipo,fechaInicio:fechaInicio,fechaFin:fechaFin,jornada:jornada,motivo:motivo}=req.body;if("ADMINISTRATIVO"===tipo){if(fechaInicio.getTime()!==fechaFin.getTime())throw new Error("Los permisos administrativos solo pueden ser de un día.");if(!motivo)throw new Error("El motivo es requerido para permisos administrativos.");if(!todosLosMotivos.includes(motivo))throw new Error("El motivo administrativo seleccionado no es válido.")}if(fechaInicio.getTime()!==fechaFin.getTime()&&"COMPLETO"!==jornada)throw new Error('Las solicitudes de varios días deben ser de jornada "COMPLETO".');return!0})];module.exports={validarCreacionSolicitud:[...reglasCreacionSolicitud,manejarValidacion]};
const PDFDocument=require("pdfkit"),generarComprobantePDF=async solicitud=>{const trabajador=solicitud.trabajador,aprobador=solicitud.aprobador,tipoPermiso="ADMINISTRATIVO"===solicitud.tipo?"Permiso Administrativo":"Teletrabajo",fechaInicioFmt=new Date(solicitud.fechaInicio).toLocaleDateString("es-CL",{timeZone:"UTC"});let detallesFecha=`${fechaInicioFmt} (Jornada: ${solicitud.jornada})`;if("TELETRABAJO"===solicitud.tipo&&solicitud.fechaFin&&solicitud.fechaInicio!==solicitud.fechaFin){const fechaFinFmt=new Date(solicitud.fechaFin).toLocaleDateString("es-CL",{timeZone:"UTC"});detallesFecha=`Del ${fechaInicioFmt} al ${fechaFinFmt}`}return new Promise((resolve,reject)=>{try{const doc=new PDFDocument({margin:50}),buffers=[];doc.on("data",buffers.push.bind(buffers)),doc.on("end",()=>{const pdfData=Buffer.concat(buffers);resolve(pdfData)}),doc.fontSize(20).font("Helvetica-Bold").text("Comprobante de Solicitud de Permiso",{align:"center"}),doc.moveDown(2),doc.fontSize(14).font("Helvetica-Bold").text("1. Datos del Solicitante"),doc.fontSize(12).font("Helvetica").text(`Nombre: ${trabajador.nombreCompleto}`).text(`Área: ${trabajador.area.nombre}`).text(`Email: ${trabajador.email}`),doc.moveDown(1.5),doc.fontSize(14).font("Helvetica-Bold").text("2. Detalles de la Solicitud"),doc.fontSize(12).font("Helvetica").text(`Tipo de Permiso: ${tipoPermiso}`).text(`Fecha permiso: ${detallesFecha}`).text(`Estado: ${solicitud.estado}`),solicitud.motivo&&doc.text(`Motivo: ${solicitud.motivo}`),doc.moveDown(1.5),doc.fontSize(14).font("Helvetica-Bold").text("3. Autorización Administrativa"),aprobador?doc.fontSize(12).font("Helvetica").text(`Aprobado por: ${aprobador.nombreCompleto}`).text(`Rol: ${aprobador.rol}`).text(`Fecha de Aprobación: ${new Date(solicitud.actualizadoEn).toLocaleString("es-CL")}`):doc.fontSize(12).font("Helvetica").text("Aprobador no registrado."),doc.moveDown(2),doc.fontSize(10).font("Helvetica-Oblique").text("Este documento es un comprobante oficial generado por el Sistema de Gestión de Permisos.",{align:"center"}),doc.end()}catch(error){reject(error)}})};module.exports={generarComprobantePDF:generarComprobantePDF};